<!DOCTYPE html>
<html>
<head>
<script src="http://polycrypt-test:8001/common/util.js"></script>
<script src="http://polycrypt-test:8001/polycrypt.js"></script>
<script>

var KEY_DATA, IV_DATA, ALGORITHM, KEY, INPUT, OUTPUT_C, OUTPUT_P; // set at load
window.polycrypt.onalive = function() {
    // Define the key variables
    KEY_DATA = new Uint32Array([0x00010203, 0x04050607, 0x08090a0b, 0x0c0d0e0f]);
    IV_DATA  = new Uint32Array([0x00010203, 0x04050607, 0x08090a0b, 0x0c0d0e0f]);
    ALGORITHM = { name: "AES-CBC", params: { iv: IV_DATA } };

    // Grab handles to DOM objects
    INPUT = document.getElementById("INPUT");
    OUTPUT_C = document.getElementById("OUTPUT_C");
    OUTPUT_P = document.getElementById("OUTPUT_P");

    // Import the key
    var imp = window.polycrypt.importKey("raw", KEY_DATA);
    imp.oncomplete = function(e) {
        KEY = e.target.result
    }
}

// Pre-defined: ALGORITHM, KEY, INPUT, OUTPUT_C, OUTPUT_P
function go() {
  var pt = util.str2abv(INPUT.value);

  var enc = window.polycrypt.encrypt(ALGORITHM, KEY, pt);
  enc.oncomplete = function(e) {
    var ct = e.target.result;
    OUTPUT_C.value = util.abv2hex(ct);
  
    var dec = window.polycrypt.decrypt(ALGORITHM, KEY, ct);
    dec.oncomplete = function(e) {
      var pt = e.target.result;
      OUTPUT_P.value = util.abv2str(pt);
    }
  }
}
</script>
</head>

<body style="font-family: Monospace;">

<table>
    <tr>
        <td>INPUT:</td>
        <td><input id="INPUT" type="text" size="100" onkeyup="go();"></td>
    </tr>
    <tr>
        <td>OUTPUT_C:</td>
        <td><input id="OUTPUT_C" type="text" size="100" disabled></td>
        <td></td>
    </tr>
    <tr>
        <td>OUTPUT_P:</td>
        <td><input id="OUTPUT_P" type="text" size="100" disabled></td>
        <td></td>
    </tr>
</table>

</body>
</html>

